!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){a.fn.tweet=function(b){function c(a,b){if("string"==typeof a){var c=a;for(var d in b){var e=b[d];c=c.split("{"+d+"}").join(null===e?"":e)}return c}return a(b)}function d(b,c){return function(){var d=[];return this.each(function(){d.push(this.replace(b,c))}),a(d)}}function e(a){return a.replace(/</g,"&lt;").replace(/>/g,"^&gt;")}function f(a,b){return a.replace(q,function(a){for(var c=/^[a-z]+:/i.test(a)?a:"http://"+a,d=a,f=0;f<b.length;++f){var g=b[f];if(g.url===c&&g.expanded_url){c=g.expanded_url,d=g.display_url;break}}return'<a href="'+e(c)+'">'+e(d)+"</a>"})}function g(a){return Date.parse(a.replace(/^([a-z]{3})( [a-z]{3} \d\d?)(.*)( \d{4})$/i,"$1,$2$4$3"))}function h(a){var b=function(a){return parseInt(a,10)},c=new Date,d=b((c.getTime()-a)/1e3);return 1>d&&(d=0),{days:b(d/86400),hours:b(d/3600),minutes:b(d/60),seconds:b(d)}}function i(a){return a.days>2?p.days_ago_text.replace(/%d/,a.days):a.hours>24?p.a_day_ago_text:a.hours>2?p.hours_ago_text.replace(/%d/,a.hours):a.minutes>45?p.a_hours_ago_text:a.minutes>2?p.minutes_ago_text.replace(/%d/,a.minutes):a.seconds>1?p.seconds_ago_text.replace(/%d/,a.seconds):p.just_now_text}function j(a){return a.match(/^(@([A-Za-z0-9-_]+)) .*/i)?p.auto_join_text_reply:a.match(q)?p.auto_join_text_url:a.match(/^((\w+ed)|just) .*/im)?p.auto_join_text_ed:a.match(/^(\w*ing) .*/i)?p.auto_join_text_ing:p.auto_join_text_default}function k(){var a=null===p.fetch?p.count:p.fetch,b="&include_entities=1";if(p.list)return p.twitter_oauth_url+"?type=list&owner_screen_name="+p.username[0]+"&list_id="+p.list_id+"&slug="+p.list+"&page="+p.page+"&count="+a+"&include_rts="+(p.retweets?"&include_rts=1":"")+b;if(p.favorites)return p.twitter_oauth_url+"?type=favorites&screen_name="+p.username[0]+"&page="+p.page+"&count="+a+b;if(null===p.query&&1===p.username.length)return p.twitter_oauth_url+"?type=usertimeline&screen_name="+p.username[0]+"&count="+a+(p.retweets?"&include_rts=1":"")+"&page="+p.page+b;var c=p.query||"from:"+p.username.join(" OR from:");return p.twitter_oauth_url+"?type=search&q="+encodeURIComponent(c)+"&count="+a+"&page="+p.page+b}function l(a,b){return b?"user"in a?a.user.profile_image_url_https:l(a,!1).replace(/^http:\/\/[a-z0-9]{1,3}\.twimg\.com\//,"https://s3.amazonaws.com/twitter_production/"):a.profile_image_url||a.user.profile_image_url}function m(b){var d={};return d.item=b,d.source=b.source,d.screen_name=b.from_user||b.user.screen_name,d.name=b.from_user_name||b.user.name,d.retweet="undefined"!=typeof b.retweeted_status,d.tweet_time=g(b.created_at),d.join_text="auto"===p.join_text?j(b.text):p.join_text,d.tweet_id=b.id_str,d.twitter_base="http://"+p.twitter_url+"/",d.user_url=d.twitter_base+d.screen_name,d.tweet_url=d.user_url+"/status/"+d.tweet_id,d.reply_url=d.twitter_base+"intent/tweet?in_reply_to="+d.tweet_id,d.retweet_url=d.twitter_base+"intent/retweet?tweet_id="+d.tweet_id,d.favorite_url=d.twitter_base+"intent/favorite?tweet_id="+d.tweet_id,d.retweeted_screen_name=d.retweet&&b.retweeted_status.user.screen_name,d.tweet_relative_time=i(h(d.tweet_time)),d.entities=b.entities?(b.entities.urls||[]).concat(b.entities.media||[]):[],d.tweet_raw_text=d.retweet?"RT @"+d.retweeted_screen_name+" "+b.retweeted_status.text:b.text,d.tweet_text=a([f(d.tweet_raw_text,d.entities)]).linkUser().linkHash()[0],d.retweeted_tweet_text=a([f(b.text,d.entities)]).linkUser().linkHash()[0],d.tweet_text_fancy=a([d.tweet_text]).makeHeart()[0],d.avatar_size=p.avatar_size,d.avatar_url=l(d.retweet?b.retweeted_status:b,"https:"===document.location.protocol),d.avatar_screen_name=d.retweet?d.retweeted_screen_name:d.screen_name,d.avatar_profile_url=d.twitter_base+d.avatar_screen_name,d.user=c('<a class="tweet_user" href="{user_url}">{screen_name}</a>',d),d.join=p.join_text?c('<span class="tweet_join">{join_text}</span>',d):"",d.avatar=d.avatar_size?c('<a class="tweet_avatar" href="{avatar_profile_url}"><img src="{avatar_url}" height="{avatar_size}" width="{avatar_size}" alt="{avatar_screen_name}\'s avatar" title="{avatar_screen_name}\'s avatar" border="0"/></a>',d):"",d.time=c('<span class="tweet_time"><a href="{tweet_url}" title="view tweet on twitter">{tweet_relative_time}</a></span>',d),d.text=c('<span class="tweet_text">{tweet_text_fancy}</span>',d),d.retweeted_text=c('<span class="tweet_text">{retweeted_tweet_text}</span>',d),d.reply_action=c('<a class="tweet_action tweet_reply" href="{reply_url}">reply</a>',d),d.retweet_action=c('<a class="tweet_action tweet_retweet" href="{retweet_url}">retweet</a>',d),d.favorite_action=c('<a class="tweet_action tweet_favorite" href="{favorite_url}">favorite</a>',d),d}function n(b,d){var e=a('<ul class="tweet_list">');e.append(a.map(d,function(a){return"<li>"+c(p.template,a)+"</li>"}).join("")).children("li:first").addClass("tweet_first").end().children("li:odd").addClass("tweet_even").end().children("li:even").addClass("tweet_odd"),a(b).empty().append(e),p.intro_text&&e.before('<p class="tweet_intro">'+p.intro_text+"</p>"),p.outro_text&&e.after('<p class="tweet_outro">'+p.outro_text+"</p>"),a(b).trigger("loaded").trigger(0===d.length?"empty":"full"),p.refresh_interval&&window.setTimeout(function(){a(b).trigger("tweet:load")},1e3*p.refresh_interval)}function o(b){var c=a('<p class="loading">'+p.loading_text+"</p>");p.loading_text&&a(b).not(":has(.tweet_list)").empty().append(c),a.getJSON(k(),function(c){if(c&&c.errors&&a.isArray(c.errors))return void a.each(c.errors,function(a,b){console.info(b)});var d=a.map(c.results||c,m);d=a.grep(d,p.filter).sort(p.comparator).slice(0,p.count),a(b).trigger("tweet:retrieved",[d])})}var p=a.extend({twitter_oauth_url:"../includes/tweet/index.php",username:null,list:null,list_id:null,favorites:!1,query:null,avatar_size:null,count:3,fetch:null,page:1,retweets:!0,intro_text:null,outro_text:null,join_text:null,auto_join_text_default:" I said, ",auto_join_text_ed:" I ",auto_join_text_ing:" I am ",auto_join_text_reply:" I replied to ",auto_join_text_url:" I was looking at ",loading_text:"loading tweets...",refresh_interval:null,twitter_url:"twitter.com",template:"{avatar}{time}{join} {text}",comparator:function(a,b){return b.tweet_time-a.tweet_time},filter:function(){return!0},just_now_text:"just now",seconds_ago_text:"about %d seconds ago",a_minutes_ago_text:"about a minute ago",minutes_ago_text:"about %d minutes ago",a_hours_ago_text:"about an hour ago",hours_ago_text:"about %d hours ago",a_day_ago_text:"about a day ago",days_ago_text:"about %d days ago",view_text:"view tweet on twitter"},b),q=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi;return a.extend({tweet:{t:c}}),a.fn.extend({linkUser:d(/(^|[\W])@(\w+)/gi,'$1<span class="at">@</span><a href="http://'+p.twitter_url+'/$2">$2</a>'),linkHash:d(/(?:^| )[\#]+([\w\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u00ff\u0600-\u06ff]+)/gi,' <a href="https://'+p.twitter_url+"/search?q=%23$1&src=hash&lang=all"+(p.username&&1===p.username.length&&!p.list?"&from="+p.username.join("%2BOR%2B"):"")+'" class="tweet_hashtag">#$1</a>'),makeHeart:d(/(&lt;)+[3]/gi,"<tt class='heart'>&#x2665;</tt>")}),this.each(function(b,c){p.username&&"string"==typeof p.username&&(p.username=[p.username]),a(c).unbind("tweet:render").unbind("tweet:retrieved").unbind("tweet:load").bind({"tweet:load":function(){o(c)},"tweet:retrieved":function(b,d){a(c).trigger("tweet:render",[d])},"tweet:render":function(b,d){n(a(c),d)}}).trigger("tweet:load")})}});